# TDD (测试驱动开发)

* 什么是 TDD
* 为什么要 TDD
* 怎么 TDD
* FAQ
* 学习路径
* 延伸阅读

## 什么是tdd

TDD 有广义和狭义之分，常说的是狭义的 TDD，也就是 UTDD（Unit Test Driven Development）。广义的 TDD 是 ATDD（Acceptance Test Driven Development），包括 BDD（Behavior Driven Development）和 Consumer-Driven Contracts Development 等。
本文所说的 TDD 指狭义上的 TDD，也就是「单元测试驱动开发」。



    TDD 是敏捷开发中的一项核心实践和技术，也是一种设计方法论。TDD的原理是在开发功能代码之前，先编写单元测试用例代码，测试代码确定需要编写什么产品代码。TDD 是 XP（Extreme Programming）的核心实践。它的主要推动者是 Kent Beck。


* Test-Driven Development，测试驱动开发。
* Task-Driven Development，任务驱动开发，要对问题进行分析并进行任务分解。
* Test-Driven Design，测试保护下的设计改善。TDD 并不能直接提高设计能力，它只是给你更多机会和保障去改善设计。

## 为什么要 TDD

### 传统编码方式 VS TDD 编码方式

传统编码方式

* 需求分析，想不清楚细节，管他呢，先开始写

* 发现需求细节不明确，去跟业务人员确认

* 确认好几次终于写完所有逻辑

* 运行起来测试一下，靠，果然不工作，调试

* 调试好久终于工作了

* 转测试，QA 测出 bug，debug， 打补丁

* 终于，代码可以工作了

* 一看代码烂的像坨屎，不敢动，动了还得手工测试，还得让 QA 测试，还得加班...

TDD 编码方式

* 先分解任务，分离关注点（后面有演示）

* 列 Example，用实例化需求，澄清需求细节

* 写测试，只关注需求，程序的输入输出，不关心中间过程

* 写实现，不考虑别的需求，用最简单的方式满足当前这个小需求即可

* 重构，用手法消除代码里的坏味道

* 写完，手动测试一下，基本没什么问题，有问题补个用例，修复

* 转测试，小问题，补用例，修复

* 代码整洁且用例齐全，信心满满地提交


## TDD 的好处

* 降低开发者负担

* 通过明确的流程，让我们一次只关注一个点，思维负担更小。

保护网

* TDD 的好处是覆盖完全的单元测试，对产品代码提供了一个保护网，让我们可以轻松地迎接需求变化或改善代码的设计。

* 所以如果你的项目需求稳定，一次性做完，后续没有任何改动的话，能享受到 TDD 的好处就比较少了。

提前澄清需求

* 先写测试可以帮助我们去思考需求，并提前澄清需求细节，而不是代码写到一半才发现不明确的需求。

快速反馈

* 有很多人说 TDD 时，我的代码量增加了，所以开发效率降低了。但是，如果没有单元测试，你就要手工测试，你要花很多时间去准备数据，启动应用，跳转界面等，反馈是很慢的。准确说，快速反馈是单元测试的好处。

## 如何tdd 编程

* 写一个测试用例
* 运行测试
* 写刚好能让测试通过的实现
* 运行测试
* 识别坏味道，用手法修改代码
* 运行测试

你可能会问，我写一个测试用例，它明显会失败，还要运行一下吗？

是的。你可能以为测试只有成功和失败两种情况，然而，失败有无数多种，运行测试才能保证当前的失败是你期望的失败。

一切都是为了让程序符合预期，这样当出现错误的时候，就能很快定位到错误（它一定是刚刚修改的代码引起的，因为一分钟前代码还是符合我的预期的）。

通过这种方式，节省了大量的调试代码的时间。

## TDD 的三条规则

1. 除非是为了使一个失败的 unit test 通过，否则不允许编写任何产品代码

2. 在一个单元测试中，只允许编写刚好能够导致失败的内容（编译错误也算失败）

3. 只允许编写刚好能够使一个失败的 unit test 通过的产品代码

## Example

### 写代码之前要做的事

1. 初始化环境

`yarn init -y`

2. 安装依赖

`yarn add jest babel-jest @babel/core @babel/preset-env -D`

3. 创建文件夹

* src 编辑文件夹

* docs 文档文件夹

* __test__ 测试文件夹

4. 配置babel,让cmd模式兼容es6模式

```
# babel.config.js
module.exports = {
  presets: [
    [
      '@babel/preset-env',
      {
        targets: {
          node: 'current',
        },
      },
    ],
  ],
};
```

5. 编写package.json中的scripts

```
  "test": "jest",
  "cov": "jest --coverage"
```
